{% extends "layout.html" %}
{% block content %}
    <div class="container">
        <table class="table table-bordered" id="ROB">
            <tr>
                {% for col in type %}
                    <th>{{ col }}</th>
                {% endfor %}
                {% for marker in mark %}
                    <th>{{ marker }}</th>
                {% endfor %}
            </tr>
            {% for p in range(size) %}
                <tr id="ROB_row{{p}}">
                    {% for q in range(type|length) %}
                        <th class="ROB_col{{q}}"></th>
                    {% endfor %}
                    {% for markers in mark %}
                        <th class="ROB_{{markers}}"></th>
                    {% endfor %}                
                </tr>
            {% endfor %}
        </table>
        
        <input type="button" id="fetch" value="Click"></input>
    </div>
{% endblock content %}

{% block script %}
    <script type="text/javascript">

        var instructions = JSON.parse('{{ inst|tojson|safe }}');
        console.log(instructions);
        
        let size = 8;
        let PC   = 0;
        let head = 0;

        $(document).ready(function(){
            $('#fetch').click(function(){
                if(PC%4 == 0 && PC != 0){
                    commit();
                }
                loading();
                console.log(PC);
            });
        });   

        function loading(){
            var cols = document.getElementById("ROB_row".concat($("#ROB tr:not(:has(th:not(:empty))):first").index()-1));
            //console.log(cols);
            var children = cols.children;
            PC = (PC+1)-size > 0? PC-(size-1) : PC;
            if(PC < instructions.length){
                for(var i=0; i<instructions[0].length; i++){
                    children[i].innerHTML = instructions[PC][i];
                }               
                var update = function updateROB(){
                    for(var i=0; i<children.length; i++){
                        switch(children[i].className){
                            case "ROB_BUSY":
                                children[i].innerHTML = 1;
                                break;
                            case "ROB_TAG":
                                break;                                
                            case "ROB_TAG_OLD":
                                break;                                
                        }
                    }                    
                }
                update();
                PC++;
            }
        }    

        function commit(){
            var finish_inst = document.getElementById("ROB_row".concat(head));
            var commit = finish_inst.getElementsByTagName('th')[4];
            commit.innerHTML = 0;
            head++;
            //console.log(head);
        }

    </script>
{% endblock script %}